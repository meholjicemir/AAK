function handleClientLoad() { gapi.load("client:auth2", initClient) } function initClient() { gapi.client.init({ discoveryDocs: DISCOVERY_DOCS, clientId: Google_ClientId, scope: SCOPES }).then(function () { gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus), updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()), authorizeButton.onclick = handleAuthClick, signoutButton.onclick = handleSignoutClick }) } function updateSigninStatus(e) { if (e) { authorizeButton.style.display = "none", signoutButton.style.display = "block"; var t = gapi.auth2.getAuthInstance().currentUser.Ab.w3.U3, n = gapi.auth2.getAuthInstance().currentUser.Ab.Zi.id_token; ValidateUser(t, n, gapi.auth2.getAuthInstance().currentUser.Ab.Zi.access_token) } else authorizeButton.style.display = "block", signoutButton.style.display = "none" } function handleAuthClick(e) { gapi.auth2.getAuthInstance().signIn() } function handleSignoutClick(e) { gapi.auth2.getAuthInstance().signOut() } function CreateGoogleCalendarEvent(e, t) { var n = e.VrstaRadnjeName + " (" + CurrentCase.Naziv + ")", o = e.Biljeske, a = new Date(e.DatumRadnje), i = new Date(e.DatumRadnje); i.setHours(new Date(e.DatumRadnje).getHours() + 1); var c = { summary: n, description: o, location: "", start: { dateTime: a.toISOString(), timeZone: "Europe/Sarajevo" }, end: { dateTime: i.toISOString(), timeZone: "Europe/Sarajevo" } }, r = gapi.client.calendar.events.insert({ calendarId: GoogleCalendarId, resource: c }); r.execute(function (n) { e.GoogleEventId = n.id, t(e) }) } function DeleteGoogleCalendarEvent(e) { var t = gapi.client.calendar.events["delete"]({ calendarId: GoogleCalendarId, eventId: e }); t.execute() } function DownloadFileFromGoogleDrive(e, t) { var n = new XMLHttpRequest; n.open("GET", "https://www.googleapis.com/drive/v3/files/" + e + "?alt=media", !0), n.setRequestHeader("Authorization", "Bearer " + CurrentUser.AccessToken), n.responseType = "arraybuffer", n.onload = function (o) { if (403 == n.status) window.open("https://drive.google.com/drive/u/0/folders/" + e, "_blank"); else { var a = n.response, i = document.createElement("a"); document.body.appendChild(i), i.style = "display: none"; var c = new Blob([a], { type: "octet/stream" }); url = window.URL.createObjectURL(c), i.href = url, i.download = t, i.click(), window.URL.revokeObjectURL(url) } }, n.send() } function OpenPicker() { gapi.load("picker", { callback: onPickerApiLoad }) } function createPicker() { var e = new google.picker.DocsView; if (e.setParent(GoogleDriveRootFolderId), e.setIncludeFolders(!0), e.setSelectFolderEnabled(!0), pickerApiLoaded && CurrentUser.AccessToken) { var t = (new google.picker.PickerBuilder).addView(e).setOAuthToken(CurrentUser.AccessToken).setCallback(pickerCallback).build(); t.setVisible(!0) } } function pickerCallback(e) { var t = "nothing"; if (e[google.picker.Response.ACTION] == google.picker.Action.PICKED) { var n = e[google.picker.Response.DOCUMENTS][0]; t = n[google.picker.Document.URL] } if ("nothing" != t) switch (CurrentGoogleDocSelection.DocName = n.name, CurrentGoogleDocSelection.DocId = n.id, CurrentGoogleDocSelection.Tip) { case "radnja": $("#aCase_Radnja_DocumentLink").html(n.name), $("#aCase_Radnja_DocumentLink").attr("href", t), $("#aCase_Radnja_DocumentLink").attr("google_drive_doc_id", n.id), $("#btnCase_Radnja_RemoveGoogleDoc").show(); break; case "dokument": $("#aCase_Document_DocumentLink").html(n.name), $("#aCase_Document_DocumentLink").attr("href", t), $("#aCase_Document_DocumentLink").attr("google_drive_doc_id", n.id), $("#btnCase_Document_RemoveGoogleDoc").show(), -1 != $("#ddlCase_Document_TipDokumenta").val() && "" != $("#aCase_Document_DocumentLink").html() && $("#btnAppendDocumentToCase").removeAttr("disabled") } } function onPickerApiLoad() { pickerApiLoaded = !0, createPicker() } var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"], SCOPES = "profile email https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/drive.readonly", authorizeButton = document.getElementById("authorize-button"), signoutButton = document.getElementById("signout-button");